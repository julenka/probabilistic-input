<!DOCTYPE html>
<html>
<head>
    <title>Draggable Box Test</title>

    <!-- JQuery -->
    <script type="text/javascript" src="../lib/jquery.js"></script>

    <!-- Snap SVG library -->
    <script type="text/javascript" src="../lib/snap.svg.js"></script>
    
    <!-- Julia library -->
    <script type="text/javascript" src="../julia.js"></script>

    <!-- Julia CSS -->
    <link type="text/css" rel="stylesheet" href="../julia.css"/>

    <!-- Draggable/Resizeable -->
    <script type="text/javascript" src="../views/draggable_resizeable_box.js"></script>

</head>
<body>
<div class="test-description">This test contains a box that can be dragged around. Use your mouse to drag the box around the canvas</div>
<table>
    <tr>
        <td>
            <svg id="draggable_svg" class="test-interface" width="400" height="400"></svg>
        </td>
        <td>
            <div id="alternatives" class=" unselectable"></div>
        </td>

    </tr>
</table>
<div class="test-description">This test contains a box that can be dragged (pink), and a box that can be dragged and resized (green).</div>
<table>
    <tr>
        <td>
            <svg id="draggable_resizeable_svg" class="test-interface" width="400" height="400"></svg>
        </td>
        <td>
            <div id="alternatives2" class=" unselectable"></div>
        </td>

    </tr>
</table>
<div class="test-description">This test contains a box that can be dragged (pink) and  a box that can be dragged and resized, however vertical motions when in the
    horizontal resize state cause the interactor to move to the dragging state, and horizontal motions while in the vertical state
    cause the interactor to go to dragging as well. In this way, users can 'snap out' or disambiguate between states.
</div>
<table>
    <tr>
        <td>
            <svg id="draggable_resizeable2_svg" class="test-interface" width="400" height="400"></svg>
        </td>
        <td>
            <div id="alternatives3" class=" unselectable"></div>
        </td>

    </tr>
</table>
<script>
    var MyCursor = Cursor.subClass({
        className: "MyCursor",
        clone: function() {
            var result = new MyCursor(this.julia);
            this.copyFsm(result);
            this.cloneActionRequests(result);
            this.copyProperties(result);
            return result;
        },
        equals: function(other) { return true}
    });

    // Global variables


    function buildTest(julia, $sketch, $alternatives, childViews, feedback) {
        var rootView = new ContainerView(julia, "#C2CCD1");
        julia.setRootView(rootView);

        childViews.forEach(function(child) {
            rootView.addChildView(child);
        });

        var mouseHook = new PMouseEventHook($sketch[0]);
        mouseHook.variance_x_px = 10;
        mouseHook.variance_y_px = 10;
        julia.addEventSource(mouseHook);

        julia.drawFeedback($sketch, feedback);

        julia.dispatchCompleted = function(new_alternatives, uiUpdated) {
            if(!uiUpdated) {
                return;
            }
            $sketch.empty();
            julia.drawFeedback($sketch, feedback);
            julia.dumpAlternativesAsSnap($alternatives, $sketch.width(), $sketch.height(), 0.25)
        };
    }

    $(document).ready(function(){
        var itemSize = 50;
        var maxWidth = $("#draggable_svg").width() - itemSize;
        var maxHeight = $("#draggable_svg").height() - itemSize;
        var julia = new Julia();
        buildTest(julia, $("#draggable_svg"), $("#alternatives"),
                [new DraggableBox(julia, Math.randint(0, maxWidth), Math.randint(0, maxHeight), itemSize, itemSize, true).attr({color: "#ffdddd"})],
                 new MostLikelyFeedback(julia));

        julia = new Julia();
        buildTest(julia, $("#draggable_resizeable_svg"), $("#alternatives2"),
                [
                    new DraggableResizeableBox(julia, Math.randint(0, maxWidth), Math.randint(0, maxHeight), itemSize, itemSize, itemSize / 5).attr({color:  "#ddffdd"}),
                    new DraggableBox(julia, Math.randint(0, maxWidth), Math.randint(0, maxHeight), itemSize, itemSize, itemSize / 5).attr({color: "#ffdddd"}),
                    new MyCursor(julia)
                ],
                new SimpleFeedback(julia, FeedbackOpacityView)
        );

        julia = new Julia();
        buildTest(julia, $("#draggable_resizeable2_svg"), $("#alternatives3"),
                [
                    new DraggableResizeableBox2(julia, Math.randint(0, maxWidth), Math.randint(0, maxHeight), itemSize, itemSize, itemSize / 5).attr({color:  "#ddffdd"}),
                    new DraggableBox(julia, Math.randint(0, maxWidth), Math.randint(0, maxHeight), itemSize, itemSize, itemSize / 5).attr({color: "#ffdddd"}),
                ],
                new SimpleFeedback(julia, FeedbackOpacityView)
        );

    });
</script>
</body>
</html>