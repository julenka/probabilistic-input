<!DOCTYPE html>
<html>
<head>
    <title>Text Selection Demo</title>

    <!-- JQuery -->
    <script type="text/javascript" src="../lib/jquery.js"></script>

    <!-- Snap SVG library -->
    <script type="text/javascript" src="../lib/snap.svg.js"></script>

    <!-- Julia library -->
    <script type="text/javascript" src="../julia.js"></script>
    <script type="text/javascript" src="../views/text_view.js"></script>
    <script type="text/javascript" src="../views/scroll_view.js"></script>

    <link rel="stylesheet" href="../julia.css"/>
    <style>
        #test_svg {
            float: left;
        }
    </style>
</head>
<body>
<h4>Text Selection</h4>
<div id="demo_settings"></div>
<svg id="test_svg" class="border1px unselectable" width="500" height="500"></svg>
<div id="alternatives"></div>
<script>
// Add any controls here

</script>

<script>
    // Global variables
    var julia = new Julia({nSamplesPerEvent: 100});
    var loren_ipsum = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ac nisi id felis rutrum aliquam. Sed et risus vitae leo suscipit tincidunt dictum at sapien. Integer sit amet augue leo. Quisque aliquet fermentum nisl id tincidunt. Phasellus pretium dolor vitae libero facilisis, iaculis dictum sem molestie. Suspendisse ac semper augue, ut ullamcorper lorem. Interdum et malesuada fames ac ante ipsum primis in faucibus.";
    for(var i = 0; i < 3; i++){
        loren_ipsum += loren_ipsum;
    }

    /**
     *
     * attributes: name, id, checked
     * description: description of the option (user sees this)
     * onClick: execute when clicked
     */
    function addOption(attributes, description, onClick) {
        var option = $("<input/>")
                .attr("type", "radio")
                .attr(attributes)
                .click(onClick);
        var label = $("<label/>")
                .attr("for", attributes.id)
                .html(description);
        $("#demo_settings").append(option, label);
    }

    // Put your initialization code here
    $(document).ready(function(){
        var $sketch = $("#test_svg");
        var $alternatives = $("#alternatives");
        var pad_x = 20;
        var pad_y = 20;
        var test_div_width = $sketch.width();

        // set up Julia
        var mouseHook = new PMouseEventHook($sketch[0], 0, 0);
        julia.addEventSource(mouseHook);

        // Set up views
        var rootView = new ContainerView(julia);
        var scrollView = new ScrollView(julia);
        var textView = new HighlightTextView(julia, {x: pad_x, y: pad_y, w: test_div_width - 2 * pad_x, text: loren_ipsum});

        scrollView.addChildView(textView);
        rootView.addChildView(scrollView);
        julia.setRootView(rootView);


        // Do stuff when an event has been dispatched
        julia.feedback = new MostLikelyFeedback(julia);


        var onOptionClicked = function(feedbackFn) {
            return function(e) {
                var $this = $(this);
                julia.feedback = feedbackFn();
            }
        };

        var nBestListFollowY = function() {
            return { x: julia.mouseXSmooth + 80, y: julia.mouseY - 50};
        }
        addOption({name: "feedback_options", id:"n_best_1", checked: true},
                "most likely",
                onOptionClicked(function() { return new MostLikelyFeedback(julia)}) );
        addOption({name: "feedback_options", id:"n_best_2", checked: false},
                "gate with icon",
                onOptionClicked(function() {
                            return new NBestUIFeedback(julia, {feedback_type: NBestGate,
                            dp: 0.6,
                            n_best_location: nBestListFollowY}
                )}
                ));

        addOption({name: "feedback_options", id:"n_best_3", checked: false},
                "gate with current state",
                onOptionClicked(function() { return new MostLikelyFeedback(julia)}) );

        julia.drawFeedback($sketch, julia.feedback);

        julia.dispatchCompleted = function(new_alternatives, uiUpdated) {
            if(!uiUpdated) {
                return;
            }
            $sketch.empty();
            julia.drawFeedback($sketch, julia.feedback);
            julia.dumpAlternativesAsSnap($alternatives, $sketch.width(), $sketch.height(), 1,
                    function() {
                        $sketch.empty();
                        julia.rootView.draw($sketch);
                        julia.dumpAlternativesAsSnap($alternatives, $sketch.width(), $sketch.height(), 1);
                    }
            );

        };
    });

</script>
</body>
</html>