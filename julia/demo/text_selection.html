<!DOCTYPE html>
<html>
<head>
    <title>Text Selection Demo</title>

    <!-- Snap SVG library -->


    <!-- Julia library -->
    <script type="text/javascript" src="../dist/julia.js"></script>
    <script type="text/javascript" src="../views/highlight_text_view.js"></script>
    <script type="text/javascript" src="../views/scroll_view.js"></script>

    <link rel="stylesheet" href="../julia.css"/>
    <style>
        #test_svg {
            float: left;
            cursor: none;
        }
    </style>
</head>
<body>
<h4>Text Selection</h4>
<div id="demo_settings"></div>
<svg id="test_svg" class="border1px unselectable" width="640" height="480"></svg>
<div id="alternatives"></div>
<script>
// Add any controls here

</script>

<script>
    // Global variables
    var julia = new Julia({nSamplesPerEvent: 100});
    var loren_ipsum = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ac nisi id felis rutrum aliquam. Sed et risus vitae leo suscipit tincidunt dictum at sapien. Integer sit amet augue leo. Quisque aliquet fermentum nisl id tincidunt. Phasellus pretium dolor vitae libero facilisis, iaculis dictum sem molestie. Suspendisse ac semper augue, ut ullamcorper lorem. Interdum et malesuada fames ac ante ipsum primis in faucibus.";
    for(var i = 0; i < 3; i++){
        loren_ipsum += loren_ipsum;
    }

    /**
     *
     * attributes: name, id, checked
     * description: description of the option (user sees this)
     * onClick: execute when clicked
     */
    function addOption(attributes, description, onClick) {
        var option = $("<input/>")
                .attr("type", "radio")
                .attr(attributes)
                .click(onClick);
        var label = $("<label/>")
                .attr("for", attributes.id)
                .html(description);
        $("#demo_settings").append(option, label);
    }

    // Put your initialization code here
    $(document).ready(function(){
        var $sketch = $("#test_svg");
        var $alternatives = $("#alternatives");
        var pad_x = 20;
        var pad_y = 20;
        var test_div_width = $sketch.width();

        // set up Julia
        var mouseHook = new PMouseEventHook($sketch[0], 0, 0);
        var touchHook = new PTouchEventHook($sketch[0], 20, 20);
        julia.addEventSource(mouseHook);
        julia.addEventSource(touchHook);

        // Set up views
        var rootView = new ContainerView(julia);
        var scrollView = new ScrollView(julia);
        var textView = new HighlightTextView(julia, {x: pad_x, y: pad_y, w: test_div_width - 2 * pad_x, text: loren_ipsum});

        scrollView.addChildView(textView);
        rootView.addChildView(scrollView);
        julia.setRootView(rootView);

        var n_best_size = 200;

        var nBestListFollowY = function() {
            return { x: julia.mouseXSmooth - n_best_size * 1.25, y: julia.mouseY - n_best_size * 0.5};
        }

        var nBestListFollowYToTheRight = function() {
            return { x: julia.mouseXSmooth + n_best_size * 0.75, y: julia.mouseY - n_best_size * 0.5};
        }

        // Do stuff when an event has been dispatched
        julia.feedback = new MostLikelyFeedback(julia);


        var onOptionClicked = function(feedbackFn) {
            return function(e) {
                var $this = $(this);
                julia.feedback = feedbackFn();
            }
        };



        addOption({name: "feedback_options", id:"n_best_1", checked: true},
                "most likely",
                onOptionClicked(function() { return new MostLikelyFeedback(julia)}) );
        addOption({name: "feedback_options", id:"n_best_2", checked: false},
                "gate with current state",
                onOptionClicked(function() {
                            return new NBestUIFeedback(julia, {feedback_type: NBestGateZoomedIn,
                                        dp: 0.6,
                                        n_best_size: n_best_size,
                                        n_best_location: nBestListFollowY}
                            );
                        }
                ));

        addOption({name: "feedback_options", id:"n_best_3", checked: false},
                "gate with future state",
                onOptionClicked(function() {
                            return new NBestUIFeedback(julia, {feedback_type: NBestGateZoomedInFuture,
                                        dp: 0.9,
                                        n_best_size: n_best_size,
                                        n_best_location: nBestListFollowYToTheRight}
                            );
                        }
                ));

        julia.drawFeedback($sketch, julia.feedback);

        julia.dispatchCompleted = function(new_alternatives, uiUpdated) {
            $sketch.empty();
            var s = Snap($sketch[0]);

            julia.drawFeedback($sketch, julia.feedback);
            julia.dumpAlternativesAsSnap($alternatives, $sketch.width(), $sketch.height(), 0.25);
            s.circle(julia.mouseX, julia.mouseY, 30).attr({fill: "silver", opacity: 0.5});
        };

    });

</script>
</body>
</html>